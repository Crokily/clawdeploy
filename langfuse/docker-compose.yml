services:
  postgres:
    image: postgres:15-alpine
    restart: unless-stopped
    environment:
      POSTGRES_USER: langfuse
      POSTGRES_PASSWORD: langfuse
      POSTGRES_DB: langfuse
    ports:
      - "5433:5432"
    volumes:
      - langfuse_postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U langfuse -d langfuse"]
      interval: 10s
      timeout: 5s
      retries: 10

  langfuse:
    image: langfuse/langfuse:2
    restart: unless-stopped
    depends_on:
      postgres:
        condition: service_healthy
    ports:
      - "3500:3000"
    environment:
      NEXTAUTH_SECRET: "WjY8dyp2WGLRCUENEz1BxYbF4CtkAAEPsGrRnjJ2lwo="
      SALT: "KoPWhBvY++uR7cXYXcTm1DIWdqHh1jhP1AN9adcrPeM="
      DATABASE_URL: postgresql://langfuse:langfuse@postgres:5432/langfuse
      NEXTAUTH_URL: https://langfuse.claw.a2a.ing
      LANGFUSE_INIT_ORG_ID: pideploy
      LANGFUSE_INIT_ORG_NAME: piDeploy
      LANGFUSE_INIT_PROJECT_ID: pideploy-orchestrator
      LANGFUSE_INIT_PROJECT_NAME: "piDeploy Orchestrator"
      LANGFUSE_INIT_PROJECT_PUBLIC_KEY: pk-lf-pideploy
      LANGFUSE_INIT_PROJECT_SECRET_KEY: sk-lf-pideploy
      LANGFUSE_INIT_USER_EMAIL: admin@pideploy.local
      LANGFUSE_INIT_USER_NAME: admin
      LANGFUSE_INIT_USER_PASSWORD: pideploy-admin-2026
      TELEMETRY_ENABLED: "false"

volumes:
  langfuse_postgres_data:
